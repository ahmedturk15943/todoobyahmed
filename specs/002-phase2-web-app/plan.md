# Implementation Plan: Full-Stack Multi-User Todo Web Application

**Branch**: `002-phase2-web-app` | **Date**: 2026-01-21 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/002-phase2-web-app/spec.md`

**Note**: This template is filled in by the `/sp.plan` command. See `.specify/templates/commands/plan.md` for the execution workflow.

## Summary

Transform the Phase I console application into a modern, multi-user web application with persistent storage and authentication. The system will provide a responsive web interface for task management (create, read, update, delete, toggle completion) with secure user authentication and complete data isolation between users. Backend API built with FastAPI and SQLModel will communicate with Neon Serverless PostgreSQL for persistence, while the Next.js frontend provides a responsive UI accessible from any modern browser.

## Technical Context

**Frontend**:
- **Framework**: Next.js 16+ with App Router
- **Language**: TypeScript
- **Styling**: Tailwind CSS
- **State Management**: React hooks and server components
- **Authentication Client**: Better Auth with JWT token handling

**Backend**:
- **Framework**: Python FastAPI
- **Language**: Python 3.13+
- **ORM**: SQLModel (combines SQLAlchemy + Pydantic)
- **Database**: Neon Serverless PostgreSQL
- **Authentication**: JWT token verification with shared secret

**Testing**:
- **Frontend**: Jest + React Testing Library
- **Backend**: pytest + pytest-asyncio
- **API Testing**: Postman/Thunder Client for manual testing
- **E2E**: Playwright (optional for Phase II)

**Target Platform**: Web browsers (Chrome, Firefox, Safari, Edge - last 2 years)

**Project Type**: Web application (monorepo with frontend/ and backend/ directories)

**Performance Goals**:
- Page load time: < 2 seconds
- API response time: < 500ms for CRUD operations
- Task creation: < 3 seconds end-to-end
- Support 100 concurrent users without degradation

**Constraints**:
- Session expiry: 7 days of inactivity
- Task title: 1-200 characters (required)
- Task description: 0-1000 characters (optional)
- No email verification required (simplified signup)
- No password reset functionality (Phase II scope limitation)

**Scale/Scope**:
- Expected users: 100-1000 users
- Tasks per user: Up to 10,000 tasks
- Responsive design: 320px (mobile) to 1920px (desktop)
- Single geographic region deployment

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

### Principle I: Spec-Driven Development ✅ PASS
- [x] Specification written and approved before implementation
- [x] Plan generated from specification
- [x] Tasks will be broken down from plan
- [x] Implementation will be generated by Claude Code
- [x] No manual coding planned

**Status**: Compliant - Following strict spec-driven workflow

### Principle II: Test-First ✅ PASS
- [x] Tests will be written before implementation
- [x] Red-Green-Refactor cycle will be followed
- [x] Backend: pytest for API and service layer tests
- [x] Frontend: Jest + React Testing Library for component tests

**Status**: Compliant - TDD approach planned for both frontend and backend

### Principle III: Incremental Evolution ✅ PASS
- [x] Phase II builds on Phase I console app
- [x] Maintains core task CRUD functionality
- [x] Adds multi-user support and web interface
- [x] Independently deployable

**Status**: Compliant - Phase II is proper evolution from Phase I

### Principle IV: Reusable Intelligence ⚠️ PARTIAL
- [x] Will leverage existing SpecKit Plus commands
- [x] Will create PHR records for all prompts
- [ ] Agent Skills for deployment (deferred to Phase IV)
- [ ] Subagents for complex workflows (not required for Phase II)

**Status**: Partial compliance - Full reusable intelligence deferred to later phases

### Principle V: Clean Code Architecture ✅ PASS
- [x] Clear separation: models, services, API routes (backend)
- [x] Clear separation: components, pages, services (frontend)
- [x] Single Responsibility Principle enforced
- [x] Dependency Inversion via service layer
- [x] Dedicated /src folders for both frontend and backend

**Status**: Compliant - Clean architecture planned for monorepo

### Principle VI: Cloud-Native Standards ⚠️ DEFERRED
- [ ] Containerization (Docker) - Deferred to Phase III+
- [ ] Kubernetes deployment - Deferred to Phase IV
- [ ] Observability - Basic logging only in Phase II
- [ ] Infrastructure as Code - Deferred to Phase IV

**Status**: Deferred - Cloud-native standards apply to Phase IV+, not Phase II

### Principle VII: AI-Native Integration ⚠️ DEFERRED
- [ ] Conversational interface - Deferred to Phase III
- [ ] OpenAI Agents SDK - Deferred to Phase III
- [ ] MCP SDK - Deferred to Phase III

**Status**: Deferred - AI-native features are Phase III scope

### Overall Gate Status: ✅ PASS

**Justification**: Phase II focuses on web application fundamentals (authentication, persistence, multi-user support). Cloud-native and AI-native principles are explicitly scoped for later phases per constitution. All applicable principles (I, II, III, V) are compliant.

## Project Structure

### Documentation (this feature)

```text
specs/002-phase2-web-app/
├── spec.md              # Feature specification (completed)
├── plan.md              # This file (in progress)
├── research.md          # Phase 0 output (to be generated)
├── data-model.md        # Phase 1 output (to be generated)
├── quickstart.md        # Phase 1 output (to be generated)
├── contracts/           # Phase 1 output (to be generated)
│   ├── api-spec.yaml    # OpenAPI specification for REST API
│   └── README.md        # API documentation
├── checklists/
│   └── requirements.md  # Specification quality checklist (completed)
└── tasks.md             # Phase 2 output (/sp.tasks command - NOT created by /sp.plan)
```

### Source Code (repository root)

```text
# Monorepo structure for full-stack web application

backend/
├── src/
│   ├── models/
│   │   ├── __init__.py
│   │   ├── user.py          # User entity (SQLModel)
│   │   └── task.py          # Task entity (SQLModel)
│   ├── services/
│   │   ├── __init__.py
│   │   ├── auth_service.py  # Authentication logic
│   │   └── task_service.py  # Task CRUD business logic
│   ├── api/
│   │   ├── __init__.py
│   │   ├── routes/
│   │   │   ├── __init__.py
│   │   │   ├── auth.py      # Auth endpoints (signup, signin, signout)
│   │   │   └── tasks.py     # Task CRUD endpoints
│   │   ├── middleware/
│   │   │   ├── __init__.py
│   │   │   └── jwt_auth.py  # JWT verification middleware
│   │   └── dependencies.py  # FastAPI dependencies
│   ├── db/
│   │   ├── __init__.py
│   │   ├── connection.py    # Database connection setup
│   │   └── migrations/      # Alembic migrations (if needed)
│   ├── config.py            # Configuration management
│   └── main.py              # FastAPI app entry point
├── tests/
│   ├── __init__.py
│   ├── conftest.py          # pytest fixtures
│   ├── unit/
│   │   ├── test_models.py
│   │   └── test_services.py
│   ├── integration/
│   │   └── test_api.py
│   └── contract/
│       └── test_api_contract.py
├── .env.example             # Environment variables template
├── pyproject.toml           # Python dependencies (UV)
├── pytest.ini               # pytest configuration
└── README.md                # Backend setup instructions

frontend/
├── src/
│   ├── app/                 # Next.js App Router
│   │   ├── layout.tsx       # Root layout
│   │   ├── page.tsx         # Home/landing page
│   │   ├── (auth)/          # Auth route group
│   │   │   ├── signin/
│   │   │   │   └── page.tsx
│   │   │   └── signup/
│   │   │       └── page.tsx
│   │   └── (dashboard)/     # Protected route group
│   │       └── tasks/
│   │           └── page.tsx # Task list page
│   ├── components/
│   │   ├── ui/              # Reusable UI components
│   │   │   ├── Button.tsx
│   │   │   ├── Input.tsx
│   │   │   ├── Card.tsx
│   │   │   └── Modal.tsx
│   │   ├── auth/
│   │   │   ├── SignInForm.tsx
│   │   │   └── SignUpForm.tsx
│   │   └── tasks/
│   │       ├── TaskList.tsx
│   │       ├── TaskItem.tsx
│   │       ├── TaskForm.tsx
│   │       └── TaskFilters.tsx
│   ├── lib/
│   │   ├── api.ts           # API client with JWT handling
│   │   ├── auth.ts          # Better Auth configuration
│   │   └── utils.ts         # Utility functions
│   ├── types/
│   │   ├── user.ts          # User type definitions
│   │   └── task.ts          # Task type definitions
│   └── styles/
│       └── globals.css      # Global styles + Tailwind
├── public/                  # Static assets
├── tests/
│   ├── components/
│   └── integration/
├── .env.local.example       # Environment variables template
├── next.config.js           # Next.js configuration
├── tailwind.config.js       # Tailwind CSS configuration
├── tsconfig.json            # TypeScript configuration
├── package.json             # Node dependencies
├── jest.config.js           # Jest configuration
└── README.md                # Frontend setup instructions

# Root level files
.gitignore
docker-compose.yml           # Local development setup (optional)
README.md                    # Project overview and setup
CLAUDE.md                    # Root Claude Code instructions
```

**Structure Decision**: Monorepo with separate frontend/ and backend/ directories. This structure provides:
- Clear separation of concerns between frontend and backend
- Independent development and testing of each layer
- Shared specs/ directory for unified documentation
- Ability to run services independently or together via docker-compose
- Simplified deployment (both services in one repository)

## Complexity Tracking

No constitutional violations requiring justification. All complexity is justified by Phase II requirements:
- Monorepo structure: Required for full-stack web application
- Authentication layer: Required for multi-user support (FR-001, FR-002)
- Database persistence: Required for data survival across restarts (FR-005)
- API layer: Required for frontend-backend communication (FR-008)

All architectural decisions align with Clean Code Architecture (Principle V) and Incremental Evolution (Principle III).

---

## Phase 0: Research & Decisions ✅ COMPLETE

**Status**: All technical decisions documented in `research.md`

**Key Decisions Made**:
1. **Frontend**: Next.js 16+ with App Router, TypeScript, Tailwind CSS
2. **Backend**: FastAPI with async/await, SQLModel ORM
3. **Database**: Neon Serverless PostgreSQL with connection pooling
4. **Authentication**: Better Auth + JWT tokens with shared secret
5. **API Pattern**: RESTful with JSON, Bearer token authentication

**Rationale**: All decisions documented with alternatives considered and best practices identified.

**Artifacts Generated**:
- ✅ `research.md` - Complete technical research and decisions

---

## Phase 1: Design & Contracts ✅ COMPLETE

**Status**: All design artifacts generated and validated

**Data Model**:
- **User Entity**: UUID id, email (unique), password_hash, timestamps
- **Task Entity**: Integer id, user_id (FK), title, description, completed, timestamps
- **Relationship**: One-to-Many (User → Tasks) with cascade delete

**API Contracts**:
- **OpenAPI 3.0 Specification**: Complete with all endpoints, schemas, security
- **6 Task Endpoints**: List, Create, Read, Update, Delete, Toggle Complete
- **3 Auth Endpoints**: Signup, Signin, Signout
- **Authentication**: JWT Bearer tokens in Authorization header

**Project Structure**:
- **Monorepo**: Separate frontend/ and backend/ directories
- **Backend**: Clean architecture with models, services, API routes, middleware
- **Frontend**: Next.js App Router with route groups, components, lib utilities
- **Testing**: Unit, integration, and contract tests for both layers

**Artifacts Generated**:
- ✅ `data-model.md` - Complete entity definitions with validation rules
- ✅ `contracts/api-spec.yaml` - OpenAPI 3.0 specification
- ✅ `contracts/README.md` - API documentation with examples
- ✅ `quickstart.md` - Setup and testing guide

---

## Phase 2: Task Breakdown (Next Step)

**Status**: Ready for `/sp.tasks` command

**Prerequisites Met**:
- ✅ Specification complete and validated
- ✅ Implementation plan complete
- ✅ Research complete with all decisions made
- ✅ Data model defined
- ✅ API contracts specified
- ✅ Quickstart guide ready

**Next Command**: `/sp.tasks`

This will generate `tasks.md` with:
- Task breakdown organized by user story
- Dependencies and parallelization opportunities
- Acceptance criteria for each task
- Estimated complexity and order of implementation

---

## Architecture Decision Records (ADRs)

**Significant Decisions Requiring ADRs**:

1. **Monorepo Structure** (Frontend + Backend in single repo)
   - Decision: Use monorepo with separate frontend/ and backend/ directories
   - Rationale: Simplified development, shared specs, unified deployment
   - Alternatives: Separate repos (rejected due to coordination overhead)

2. **JWT Authentication Pattern** (Better Auth + FastAPI)
   - Decision: Use JWT tokens with shared secret for stateless auth
   - Rationale: Enables independent frontend/backend verification, scalable
   - Alternatives: Session-based auth (rejected due to state management complexity)

3. **Database Choice** (Neon Serverless PostgreSQL)
   - Decision: Use Neon for serverless PostgreSQL
   - Rationale: No infrastructure management, automatic scaling, generous free tier
   - Alternatives: Supabase (too many features), PlanetScale (MySQL limitations)

**ADR Creation**: Run `/sp.adr <decision-title>` after planning phase to document these decisions formally.

---

## Risk Assessment

### Technical Risks

| Risk | Likelihood | Impact | Mitigation |
|------|------------|--------|------------|
| JWT secret mismatch between frontend/backend | Medium | High | Document clearly in setup, use same .env variable name |
| CORS configuration issues | Medium | Medium | Test early, document CORS setup in quickstart |
| Database connection pool exhaustion | Low | High | Use Neon's built-in pooling, implement proper session management |
| Better Auth integration complexity | Medium | Medium | Follow official docs, test auth flow early |
| Responsive design edge cases | Low | Low | Test on multiple devices, use Tailwind breakpoints |

### Process Risks

| Risk | Likelihood | Impact | Mitigation |
|------|------------|--------|------------|
| Spec-generated code doesn't match requirements | Low | High | Iterate on spec until correct, follow TDD |
| Missing edge cases in specification | Medium | Medium | Comprehensive testing scenarios in quickstart |
| Constitution violations during implementation | Low | Medium | Regular constitution checks, complexity tracking |

### Mitigation Strategy

1. **Early Testing**: Test authentication flow before building full UI
2. **Incremental Development**: Implement user stories in priority order (P1 → P2 → P3)
3. **Continuous Validation**: Run quickstart scenarios after each user story
4. **Spec Refinement**: Update spec if requirements unclear during implementation

---

## Implementation Readiness Checklist

### Planning Phase ✅ COMPLETE

- [x] Specification approved and validated
- [x] Constitution Check passed
- [x] Technical research complete
- [x] Data model defined
- [x] API contracts specified
- [x] Quickstart guide created
- [x] Project structure documented
- [x] All NEEDS CLARIFICATION resolved

### Ready for Task Breakdown

- [x] All Phase 0 artifacts complete
- [x] All Phase 1 artifacts complete
- [x] No blocking issues identified
- [x] Architecture decisions documented

### Next Steps

1. **Run `/sp.tasks`** to generate task breakdown
2. **Review tasks.md** for completeness and dependencies
3. **Run `/sp.implement`** to execute implementation
4. **Follow quickstart.md** to validate each user story
5. **Create ADRs** for significant architectural decisions
6. **Generate PHRs** for all prompts and iterations

---

## Summary

**Phase II Planning Complete** ✅

This implementation plan provides a complete blueprint for transforming the Phase I console application into a full-stack, multi-user web application with:

- **Authentication**: Secure user signup/signin with JWT tokens
- **Multi-User Support**: Complete data isolation between users
- **Persistent Storage**: Neon PostgreSQL database with proper schema
- **RESTful API**: FastAPI backend with OpenAPI documentation
- **Responsive UI**: Next.js frontend with Tailwind CSS
- **Clean Architecture**: Separation of concerns across all layers

**All artifacts generated and ready for implementation phase.**

**Branch**: `002-phase2-web-app`
**Spec**: [spec.md](./spec.md)
**Research**: [research.md](./research.md)
**Data Model**: [data-model.md](./data-model.md)
**API Contracts**: [contracts/](./contracts/)
**Quickstart**: [quickstart.md](./quickstart.md)

**Next Command**: `/sp.tasks` to break down implementation into actionable tasks.
