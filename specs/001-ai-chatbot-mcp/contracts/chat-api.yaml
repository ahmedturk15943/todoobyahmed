openapi: 3.0.3
info:
  title: Todo Chatbot API
  description: AI-powered conversational interface for task management
  version: 1.0.0
  contact:
    name: Todo App Team

servers:
  - url: http://localhost:8000/api
    description: Local development server
  - url: https://api.todo-app.example.com/api
    description: Production server

paths:
  /{user_id}/chat:
    post:
      summary: Send chat message and get AI response
      description: |
        Send a natural language message to the AI assistant. The assistant will
        interpret the intent and perform task operations via MCP tools. Returns
        the assistant's response and conversation ID.

        This endpoint is stateless - it fetches conversation history from the
        database, processes the request, stores new messages, and returns the response.
      operationId: sendChatMessage
      tags:
        - Chat
      parameters:
        - name: user_id
          in: path
          required: true
          description: Authenticated user identifier
          schema:
            type: string
            example: "user_123abc"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - message
              properties:
                conversation_id:
                  type: integer
                  description: |
                    Existing conversation ID to continue. If not provided,
                    a new conversation will be created.
                  example: 42
                message:
                  type: string
                  description: User's natural language message
                  minLength: 1
                  maxLength: 5000
                  example: "Add a task to buy groceries"
            examples:
              newConversation:
                summary: Start new conversation
                value:
                  message: "Show me all my tasks"
              continueConversation:
                summary: Continue existing conversation
                value:
                  conversation_id: 42
                  message: "Mark task 3 as complete"
      responses:
        '200':
          description: Successful response with AI assistant's reply
          content:
            application/json:
              schema:
                type: object
                required:
                  - conversation_id
                  - response
                  - tool_calls
                properties:
                  conversation_id:
                    type: integer
                    description: Conversation ID (new or existing)
                    example: 42
                  response:
                    type: string
                    description: AI assistant's natural language response
                    example: "I've marked task 3 'Call mom' as complete."
                  tool_calls:
                    type: array
                    description: List of MCP tools invoked during processing
                    items:
                      type: object
                      properties:
                        tool:
                          type: string
                          description: Name of the MCP tool invoked
                          example: "complete_task"
                        parameters:
                          type: object
                          description: Parameters passed to the tool
                          example:
                            user_id: "user_123abc"
                            task_id: 3
                        result:
                          type: object
                          description: Result returned by the tool
                          example:
                            task_id: 3
                            status: "completed"
                            title: "Call mom"
              examples:
                taskCreated:
                  summary: Task creation response
                  value:
                    conversation_id: 42
                    response: "I've created a task 'Buy groceries' for you."
                    tool_calls:
                      - tool: "add_task"
                        parameters:
                          user_id: "user_123abc"
                          title: "Buy groceries"
                        result:
                          task_id: 15
                          status: "created"
                          title: "Buy groceries"
                taskListed:
                  summary: Task listing response
                  value:
                    conversation_id: 42
                    response: "You have 3 pending tasks: 1. Buy groceries, 2. Call mom, 3. Pay bills"
                    tool_calls:
                      - tool: "list_tasks"
                        parameters:
                          user_id: "user_123abc"
                          status: "pending"
                        result:
                          - id: 1
                            title: "Buy groceries"
                            completed: false
                          - id: 2
                            title: "Call mom"
                            completed: false
                          - id: 3
                            title: "Pay bills"
                            completed: false
        '400':
          description: Bad request - invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                emptyMessage:
                  summary: Empty message
                  value:
                    error: "Message cannot be empty"
                    code: "INVALID_INPUT"
                invalidConversation:
                  summary: Invalid conversation ID
                  value:
                    error: "Conversation not found or does not belong to user"
                    code: "INVALID_CONVERSATION"
        '401':
          description: Unauthorized - invalid or missing authentication
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: "Authentication required"
                code: "UNAUTHORIZED"
        '429':
          description: Too many requests - rate limit exceeded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: "Rate limit exceeded. Please try again later."
                code: "RATE_LIMIT_EXCEEDED"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                aiServiceError:
                  summary: AI service unavailable
                  value:
                    error: "AI service temporarily unavailable. Please try again."
                    code: "AI_SERVICE_ERROR"
                databaseError:
                  summary: Database error
                  value:
                    error: "Database error occurred. Please try again."
                    code: "DATABASE_ERROR"
        '503':
          description: Service unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: "Service temporarily unavailable"
                code: "SERVICE_UNAVAILABLE"

components:
  schemas:
    Error:
      type: object
      required:
        - error
        - code
      properties:
        error:
          type: string
          description: Human-readable error message
        code:
          type: string
          description: Machine-readable error code
        details:
          type: object
          description: Additional error details (optional)

  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token from Better Auth authentication

security:
  - BearerAuth: []

tags:
  - name: Chat
    description: Conversational interface for task management
